# CPX Exposure Event Schema

## Overview
Event fired when an ad is exposed/viewed by the user.

## Required Fields
| Field | Type | Description |
|--------|------|-------------|
| `event_type` | string | Event type identifier (always `cpx_exposure`) |
| `serve_token` | string | Serve token from the auction result |
| `session_id` | string | Session identifier |
| `platform_id` | string | Platform identifier |
| `agent_id` | string | Winning advertiser agent identifier |
| `wallet_id` | string | Wallet to charge for this exposure |
| `pricing` | object | Pricing information for this exposure |
| `ts` | string | ISO 8601 timestamp of the exposure |

## Pricing Object
| Field | Type | Description |
|--------|------|-------------|
| `unit` | string | Pricing unit (always `CPX`) |
| `amount` | string | Charge amount in USD (pattern: `^\d+\.\d{2,}$`) |
| `currency` | string | Currency code (always `USD`) |

## Optional Fields
| Field | Type | Description |
|--------|------|-------------|
| `exposure_metadata` | object | Additional exposure context |

## Exposure Metadata Object
| Field | Type | Description |
|--------|------|-------------|
| `surface` | string | UI surface where ad was shown. Enum: `chat`, `voice`, `page`, `result_card` |
| `position` | integer | Position in the result list (1-indexed, minimum: 1) |
| `visibility_ms` | integer | Time ad was visible in milliseconds (minimum: 0) |

## Example
```json
{
  "event_type": "cpx_exposure",
  "serve_token": "stk_abcxyz123",
  "session_id": "s_001",
  "platform_id": "pf_chatapp",
  "agent_id": "ag_123",
  "wallet_id": "w_890",
  "pricing": {
    "unit": "CPX",
    "amount": "0.034",
    "currency": "USD"
  },
  "exposure_metadata": {
    "surface": "chat",
    "position": 1,
    "visibility_ms": 1500
  },
  "ts": "2025-11-11T18:00:00Z"
}
```

## Validation Rules
- `event_type` must be exactly `cpx_exposure`
- `pricing.unit` must be exactly `CPX`
- `pricing.currency` must be exactly `USD`
- `pricing.amount` must match pattern: `^\d+\.\d{2,}$`
- `ts` must be in ISO 8601 date-time format
- `exposure_metadata.position` must be at least 1
- `exposure_metadata.visibility_ms` must be at least 0
