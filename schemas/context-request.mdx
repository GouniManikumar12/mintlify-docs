# Context Request Schema

## Overview
AI platform request that starts an auction. Sent by platforms to initiate ad serving.

## Required Fields
| Field | Type | Description |
|--------|------|-------------|
| `request_id` | string | Unique identifier for this context request |
| `session_id` | string | Session identifier for grouping related requests |
| `platform_id` | string | Identifier of the AI platform making the request |
| `query_text` | string | User's query or prompt text |
| `locale` | string | User's locale in BCP 47 format (e.g., `en-US`) |
| `geo` | string | User's country code (ISO 3166-1 alpha-2, e.g., `US`) |
| `ts` | string | ISO 8601 timestamp of the request |
| `auth` | object | Authentication credentials (nonce and signature) |

## Optional Fields
| Field | Type | Description |
|--------|------|-------------|
| `surface` | string | UI surface where the ad will be displayed. Enum: `chat`, `voice`, `page`, `result_card` |
| `pricing.cpx_floor` | string | Minimum CPX bid price in USD |
| `features.topic` | array | Detected topics or categories |
| `features.user_type` | string | Type of user making the query. Enum: `human`, `agent` |

## Authentication Object
| Field | Type | Description |
|--------|------|-------------|
| `nonce` | string | One-time nonce for replay protection |
| `sig` | string | HMAC signature of the request |

## Example
```json
{
  "request_id": "rq_92f",
  "session_id": "s_001",
  "platform_id": "pf_chatapp",
  "query_text": "best CRM for small teams",
  "surface": "chat",
  "locale": "en-US",
  "geo": "US",
  "pricing": {
    "cpx_floor": "0.03"
  },
  "features": {
    "topic": ["crm", "smb"],
    "user_type": "human"
  },
  "ts": "2025-11-11T18:00:00Z",
  "auth": {
    "nonce": "n_123",
    "sig": "sig_abcd"
  }
}
```

## Validation Rules
- `locale` must match pattern: `^[a-z]{2}-[A-Z]{2}$`
- `geo` must match pattern: `^[A-Z]{2}$`
- `cpx_floor` must match pattern: `^\\d+\\.\\d{2,}$`
- `ts` must be in ISO 8601 date-time format