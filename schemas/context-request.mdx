# Context Request Schema

## Overview
Normalized request that an Operator sends to subscribed Brand Agents when opening an auction. It includes the enriched intent, allowed creative formats, and an operator-signed auth block.

## Required Fields
| Field | Type | Description |
|--------|------|-------------|
| `context_id` | string | Unique ID for this auction request |
| `session_id` | string | Conversation/session identifier |
| `operator_id` | string | Identifier of the operator sending the request |
| `platform_id` | string | Upstream AI platform identifier |
| `query_text` | string | Operator-curated user query |
| `locale` | string | Locale (BCP 47, e.g., `en-US`) |
| `geo` | string | Country code (ISO 3166-1 alpha-2) |
| `intent.type` | enum | Intent class: `informational`, `commercial`, `transactional` |
| `allowed_formats` | array | Creative formats allowed: `weave`, `citation`, `product_card` |
| `timestamp` | string | ISO 8601 timestamp created by the operator |
| `auth.nonce` | string | Nonce for replay protection |
| `auth.sig` | string | Operator signature authenticating the request |

## Optional Fields
| Field | Type | Description |
|--------|------|-------------|
| `verticals` | array | Normalized topical verticals, e.g., `["crm", "smb_software"]` |
| `intent.decision_phase` | enum | Funnel stage: `research`, `compare`, `decide`, `act` |
| `intent.context_summary` | string | Operator generated summary |
| `intent.turn_index` | integer | Conversation turn index |
| `extensions` | object | Vendor-namespaced operator metadata (e.g., `extensions.admesh.*`) |

## Example
```json
{
  "context_id": "ctx_92fA1",
  "session_id": "sess_001",
  "operator_id": "admesh_operator",
  "platform_id": "openai_chat",
  "query_text": "best CRM for small teams",
  "locale": "en-US",
  "geo": "US",
  "verticals": ["crm", "smb_software"],
  "intent": {
    "type": "commercial",
    "decision_phase": "compare",
    "context_summary": "User is evaluating CRM tools and narrowing down options.",
    "turn_index": 3
  },
  "allowed_formats": ["weave", "citation", "product_card"],
  "timestamp": "2025-11-14T18:22:00Z",
  "auth": { "nonce": "nonce_123", "sig": "sig_hmac_123abc" },
  "extensions": {
    "admesh": { "operator_relevance_score": 0.87 }
  }
}
```

## Notes
- `extensions` must be vendor-namespaced objects; operators should only write inside their namespace (e.g., `extensions.admesh`).
- `allowed_formats` lets operators constrain how creatives render for the requesting platform surface.
