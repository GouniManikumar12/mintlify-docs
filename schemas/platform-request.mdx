# Platform Request Schema

## Overview
AI platform request sent to an AIP operator to initiate an ad auction. This payload uses the **UCP (User Context Protocol)** structure with nested objects for producer, context, identity, and extensions. Operators transform it into a `context_request` before distributing to brand agents.

## UCP Structure

The PlatformRequest follows the UCP specification with the following top-level structure:

| Field | Type | Description |
|-------|------|-------------|
| `spec_version` | string | UCP specification version (e.g., "1.0.0") |
| `message_id` | string | Unique identifier for this auction request |
| `timestamp` | string | ISO 8601 timestamp when the platform generated the request |
| `producer` | object | Producer information (platform/agent that created the request) |
| `context` | object | Context information (language, publisher, placement, device, geography) |
| `identity` | object | Identity information (namespace, value_hash, confidence) |
| `extensions` | object | Extensions containing AIP-specific and other vendor data |

## Producer Object

| Field | Type | Description |
|-------|------|-------------|
| `agent_id` | string | Identifier of the AI platform sending this request |
| `agent_role` | string | Role of the agent, typically "publisher" |
| `software` | string | Software name (e.g., "chatgpt") |
| `software_version` | string | Software version or model identifier (e.g., "4.3-mini") |

## Context Object

| Field | Type | Description |
|-------|------|-------------|
| `language` | string | User locale in BCP 47 format (e.g., "en-US") |
| `publisher` | string | Publisher identifier (same as producer.agent_id) |
| `placement` | object | Placement information |
| `placement.ad_unit` | string | Platform surface type: "conversation", "chat", "voice", etc. |
| `device` | object | Device information |
| `device.platform` | string | Device platform: "web", "mobile", etc. |
| `device.form_factor` | string | Device form factor: "mobile", "desktop", "tablet" |
| `device.ua_hash` | string | Optional user agent hash |
| `geography` | object | Geographic information |
| `geography.country` | string | User country code (ISO 3166-1 alpha-2, e.g., "US") |

## Identity Object

| Field | Type | Description |
|-------|------|-------------|
| `namespace` | string | Identity namespace (e.g., "platform_user") |
| `value_hash` | string | Anonymous hashed user ID |
| `confidence` | number | Confidence level for identity (0.0 to 1.0) |

## Extensions Object

The `extensions` object contains vendor-namespaced data. The `aip` namespace contains AIP-specific fields:

### AIP Extensions (`extensions.aip`)

| Field | Type | Description |
|-------|------|-------------|
| `session_id` | string | Conversation or interaction session ID |
| `turn_index` | integer | Turn index in the conversation |
| `query_text` | string | User's raw query text |
| `messages` | array | Optional short conversation history (last N turns) |
| `latency_budget_ms` | integer | Optional latency budget from platform (milliseconds) |
| `cpx_floor` | number | Minimum CPX (USD) required by the platform |

## Example

```json
{
  "spec_version": "1.0.0",
  "message_id": "req_92fA1",
  "timestamp": "2025-11-14T18:22:00Z",
  "producer": {
    "agent_id": "openai_chat",
    "agent_role": "publisher",
    "software": "chatgpt",
    "software_version": "4.3-mini"
  },
  "context": {
    "language": "en-US",
    "publisher": "openai_chat",
    "placement": {
      "ad_unit": "conversation"
    },
    "device": {
      "platform": "web",
      "form_factor": "desktop",
      "ua_hash": "ua_hash_xyz"
    },
    "geography": {
      "country": "US"
    }
  },
  "identity": {
    "namespace": "platform_user",
    "value_hash": "user_hash_abc123",
    "confidence": 1.0
  },
  "extensions": {
    "aip": {
      "session_id": "sess_001",
      "turn_index": 3,
      "query_text": "best CRM for small teams",
      "messages": [
        { "role": "user", "content": "best CRM tools?" },
        { "role": "assistant", "content": "HubSpot, Zoho, Salesforceâ€¦" }
      ],
      "latency_budget_ms": 500,
      "cpx_floor": 0.05
    }
  }
}
```

## Validation Rules

- `spec_version` must be "1.0.0" for UCP v1.0
- `message_id` must be a unique string identifier
- `context.language` must match pattern `^[a-z]{2}-[A-Z]{2}$` (BCP 47)
- `context.geography.country` must match pattern `^[A-Z]{2}$` (ISO 3166-1 alpha-2)
- `timestamp` must be RFC 3339 / ISO 8601 compliant
- `extensions` keys must be vendor namespaces (e.g., `aip`, `openai`, `vectorgrid`)
- `identity.confidence` must be between 0.0 and 1.0
