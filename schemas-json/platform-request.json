{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "PlatformRequest",
  "description": "AI platform request sent to an AIP operator to initiate an ad auction.",
  "type": "object",
  "required": [
    "request_id",
    "session_id",
    "platform_id",
    "query_text",
    "locale",
    "geo",
    "timestamp",
    "auth"
  ],
  "properties": {
    "request_id": {
      "type": "string",
      "description": "Unique identifier for this auction request",
      "example": "req_92fA1"
    },
    "session_id": {
      "type": "string",
      "description": "Conversation or interaction session ID",
      "example": "sess_001"
    },
    "platform_id": {
      "type": "string",
      "description": "Identifier of the AI platform sending this request",
      "example": "openai_chat"
    },
    "model": {
      "type": "string",
      "description": "Identifier of the AI model used for this interaction (optional)",
      "example": "gpt-4.3-mini"
    },
    "query_text": {
      "type": "string",
      "description": "User’s raw query text",
      "example": "best CRM for small teams"
    },
    "messages": {
      "type": "array",
      "description": "Optional short conversation history (last N turns). Used for operator intent inference.",
      "items": {
        "type": "object",
        "properties": {
          "role": {
            "type": "string",
            "enum": ["user", "assistant", "system"],
            "example": "user"
          },
          "content": {
            "type": "string",
            "example": "Looking for CRM recommendations"
          }
        }
      },
      "example": [
        { "role": "user", "content": "best CRM tools?" },
        { "role": "assistant", "content": "HubSpot, Zoho, Salesforce…" }
      ]
    },
    "locale": {
      "type": "string",
      "pattern": "^[a-z]{2}-[A-Z]{2}$",
      "description": "User locale in BCP 47 format",
      "example": "en-US"
    },
    "geo": {
      "type": "string",
      "pattern": "^[A-Z]{2}$",
      "description": "User country code (ISO 3166-1 alpha-2)",
      "example": "US"
    },
    "platform_surface": {
      "type": "string",
      "description": "Optional platform-defined surface or view type",
      "example": "ai_chat"
    },
    "cpx_floor": {
      "type": "number",
      "description": "Minimum CPX (USD) required by the platform for this auction request.",
      "example": 0.05
    },
    "device_type": {
      "type": "string",
      "description": "Device type: mobile, desktop, tablet",
      "enum": ["mobile", "desktop", "tablet"],
      "example": "desktop"
    },
    "conversation_id": {
      "type": "string",
      "description": "Conversation ID if independent from session_id",
      "example": "conv_abc123"
    },
    "user_id": {
      "type": "string",
      "description": "Anonymous hashed user ID for pacing & personalization",
      "example": "user_hash_xyz789"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO timestamp of the event",
      "example": "2025-11-14T18:22:00Z"
    },
    "latency_budget_ms": {
      "type": "integer",
      "description": "Optional latency budget from platform in milliseconds",
      "example": 500
    },
    "auth": {
      "type": "object",
      "required": ["nonce", "sig"],
      "properties": {
        "nonce": {
          "type": "string",
          "description": "One-time nonce for replay protection",
          "example": "nonce_12345"
        },
        "sig": {
          "type": "string",
          "description": "HMAC signature of the request",
          "example": "sig_d41d8cd98f00b204e9800998ecf8427e"
        }
      },
      "example": {
        "nonce": "nonce_12345",
        "sig": "sig_d41d8cd98f00b204e9800998ecf8427e"
      }
    },
    "metadata": {
      "$ref": "./common.json#/definitions/extensionNamespace",
      "description": "Platform extensions, modes, structured session metadata. Must be vendor-namespaced."
    }
  },
  "examples": [
    {
      "request_id": "req_92fA1",
      "session_id": "sess_001",
      "platform_id": "openai_chat",
      "model": "gpt-4.3-mini",
      "query_text": "best CRM for small teams",
      "messages": [
        { "role": "user", "content": "best CRM tools?" },
        { "role": "assistant", "content": "HubSpot, Zoho, Salesforce…" }
      ],
      "locale": "en-US",
      "geo": "US",
      "platform_surface": "ai_chat",
      "cpx_floor": 0.05,
      "device_type": "desktop",
      "user_id": "user_hash_abc123",
      "timestamp": "2025-11-14T18:22:00Z",
      "latency_budget_ms": 500,
      "auth": { "nonce": "nonce_12345", "sig": "sig_d41d8cd98f00b204e9800998ecf8427e" },
      "metadata": {
        "openai": { "model": "gpt-4.3-mini", "conversation_mode": "assistant" }
      }
    }
  ],
  "$id": "https://aip.org/schemas/platform-request.json"
}
