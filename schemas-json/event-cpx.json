{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "CPXExposureEvent",
  "description": "Event fired when an ad is exposed/viewed by the user",
  "type": "object",
  "required": ["event_type", "serve_token", "session_id", "platform_id", "agent_id", "wallet_id", "pricing", "ts"],
  "properties": {
    "event_type": {
      "type": "string",
      "const": "cpx_exposure",
      "description": "Event type identifier"
    },
    "serve_token": {
      "type": "string",
      "description": "Serve token from the auction result",
      "example": "stk_abcxyz123"
    },
    "session_id": {
      "type": "string",
      "description": "Session identifier",
      "example": "s_001"
    },
    "platform_id": {
      "type": "string",
      "description": "Platform identifier",
      "example": "pf_chatapp"
    },
    "agent_id": {
      "type": "string",
      "description": "Winning advertiser agent identifier",
      "example": "ag_123"
    },
    "wallet_id": {
      "type": "string",
      "description": "Wallet to charge for this exposure",
      "example": "w_890"
    },
    "pricing": {
      "type": "object",
      "description": "Pricing information for this exposure",
      "required": ["unit", "amount", "currency"],
      "properties": {
        "unit": {
          "type": "string",
          "const": "CPX",
          "description": "Pricing unit"
        },
        "amount": {
          "type": "string",
          "description": "Charge amount in USD",
          "pattern": "^\\d+\\.\\d{2,}$",
          "example": "0.034"
        },
        "currency": {
          "type": "string",
          "const": "USD",
          "description": "Currency code"
        }
      }
    },
    "exposure_metadata": {
      "type": "object",
      "description": "Additional exposure context",
      "properties": {
        "surface": {
          "type": "string",
          "description": "UI surface where ad was shown",
          "enum": ["chat", "voice", "page", "result_card"],
          "example": "chat"
        },
        "position": {
          "type": "integer",
          "description": "Position in the result list (1-indexed)",
          "minimum": 1,
          "example": 1
        },
        "visibility_ms": {
          "type": "integer",
          "description": "Time ad was visible in milliseconds",
          "minimum": 0,
          "example": 1500
        }
      }
    },
    "ts": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of the exposure",
      "example": "2025-11-11T18:00:00Z"
    }
  },
  "examples": [
    {
      "event_type": "cpx_exposure",
      "serve_token": "stk_abcxyz123",
      "session_id": "s_001",
      "platform_id": "pf_chatapp",
      "agent_id": "ag_123",
      "wallet_id": "w_890",
      "pricing": {
        "unit": "CPX",
        "amount": "0.034",
        "currency": "USD"
      },
      "exposure_metadata": {
        "surface": "chat",
        "position": 1,
        "visibility_ms": 1500
      },
      "ts": "2025-11-11T18:00:00Z"
    }
  ]
}

